'serviceWorker'in navigator&&navigator.serviceWorker.register('/sw.js').then(function(){console.log('service worker registered')}).catch(function(){console.warn('service worker failed')});var Pagina={iniciar(){M.AutoInit(),$('.dropdown-trigger').dropdown({hover:!1,constrainWidth:!1}),this.interface.iniciar(),GerenteDeAutenticacao.iniciar()},interface:{iniciar(){this.pesquisarTextField(),this.telaDeCarregamento()},telaAtual:'#Tela_Carregando',trocarTela(a,b){a||(a=Pagina.interface.telaAtual),Pagina.interface.telaAtual=b,$(a).css('display','none'),$(b).css('display','block'),'#Tela_Carregando'==a?Pagina.window.onresize(null):'#Tela_Busca'==a&&($('#resultados-de-busca')[0].innerHTML=`<div id="apresentacao" class="${this.tema.textColor}-text container center-align"><i class="material-icons large">search</i><h4>Fa√ßa uma busca</h4></div>`,$('#pesquisar-tela .material-icons')[0].innerHTML='search',$('#pesquisar-tela').attr('onclick','Pagina.interface.trocarTela(null,\'#Tela_Busca\')')),'#Tela_Carregando'==b?($('.mdl-layout-title')[0].innerHTML='Carregando',this.telaDeCarregamento(),Pagina.window.onresize(this.telaDeCarregamento)):'#Tela_Busca'==b&&($('#pesquisar-tela .material-icons')[0].innerHTML='close',$('#pesquisar-tela').attr('onclick','Pagina.interface.trocarTela(null,\'#Tela_Painel\')'))},login(a){a?(a.photoURL&&$('.card-img img').attr('src',`${a.photoURL}?type=large`),$('#user_name')[0].innerHTML=a.displayName,$('.logado').show(),Pagina.interface.trocarTela(null,'#Tela_Painel')):($('.card-img img').attr('src',`/img/img.jpeg`),$('#user_name')[0].innerHTML='Seja Bem-vindo',$('.logado').hide(),Pagina.interface.trocarTela(null,'#Tela_Home'))},atualizarLista(a,b){var c=b;'lista-de-poemas'==a&&(c=GerenciadorDePoemas.poemas);var d='';c.map(a=>{if(2<=a.linhas.length)var b=a.linhas[0]+'<br>'+a.linhas[1];else var b=a.linhas[0];var c='white';'white'!=a.cor&&'yellow'!=a.cor&&'amber'!=a.cor&&a.cor||(c='black'),a.cor||(a.cor='white'),d+=`<div class="col s12 m6"><div class="card ${a.cor} ${c}-text"><div class="card-content"><span class="card-title">${a.titulo}</span><p>${b}</p></div><div class="card-action right-align"><a class="btn btn-flat ${c}-text waves-effect" onclick="Pagina.interface.abrirPoema('${a.id}')">Abrir</a></div></div></div>`});var e=$(`#${a}`)[0].parentNode,f=$(e).find('#sem-poemas');''==d?f.show():f.hide(),$(`#${a}`)[0].innerHTML=d},pesquisarPoema(){const a=$('#pesquisar').val();if(''!=a&&'#Tela_Busca'==this.telaAtual){const b=GerenciadorDePoemas.poemas.map(b=>{if(-1!=b.titulo.indexOf(a))return b;for(numeroDaLinha=0;numeroDaLinha<b.linhas.length;numeroDaLinha++){const c=b.linhas[numeroDaLinha];if(-1!=c.indexOf(a))return b;break}}),c=b.filter(a=>null!=a);this.atualizarLista('resultados-de-busca',c)}},abrirModalCor(a){$('#cor-modal').modal('open'),$('#cor-modal a').click(async c=>{const b=c.target.classList[1],d=GerenciadorDePoemas.obterPoema(a);await GerenciadorDePoemas.salvarPoema(a,d.titulo,d.linhas,b);var e='white';('white'==b||'yellow'==b||'amber'==b)&&(e='black'),$('#poema-modal').attr('class',`modal ${b} ${e}-text`),$('#poema-modal ul').attr('class',`${b} dropdown-content`),$('#poema-modal .modal-footer').attr('class',`modal-footer right-align ${b}`),$('#poema-modal .modal-footer a').removeClass(`white-text`),$('#poema-modal .modal-footer a').removeClass(`black-text`),$('#poema-modal .modal-footer a').addClass(`${e}-text`),$('#cor-modal').modal('close'),this.atualizarLista('lista-de-poemas'),this.pesquisarPoema()})},abrirPoema(a){const b=GerenciadorDePoemas.obterPoema(a);var c='white';'white'!=b.cor&&'yellow'!=b.cor&&'amber'!=b.cor&&b.cor||(c='black'),b.cor||(b.cor='white'),$('#poema-modal').attr('class',`modal ${b.cor} ${c}-text`),$('#poema-modal ul').attr('class',`${b.cor} dropdown-content`),$('#poema-modal .modal-footer').attr('class',`modal-footer right-align ${b.cor}`),$('#poema-modal .modal-footer a').removeClass(`white-text`),$('#poema-modal .modal-footer a').removeClass(`black-text`),$('#poema-modal .modal-footer a').addClass(`${c}-text`),$('#poema-modal h5')[0].innerHTML=b.titulo;const d=b.linhas.join('<br>');$('#poema-modal p')[0].innerHTML=d,$('#poema-modal #cor-botao').attr('onclick',`Pagina.interface.abrirModalCor('${a}')`),$('#poema-modal #delete-botao').attr('onclick',`Pagina.interface.removerPoema('${a}')`),$('#poema-modal #editar-botao').attr('onclick',`Pagina.interface.editarPoema('${a}')`),$('#poema-modal').modal('open')},criarPoema(){$('#criar-modal #editar-titulo-poema').val(null),$('#criar-modal #editar-conteudo-poema').val(null),this.atualizarTextField(),$('#criar-modal form').attr('action',`javascript:Pagina.interface.salvarPoema(null)`),$('#criar-modal').modal('open')},editarPoema(a){this.fecharModal('poema');const b=GerenciadorDePoemas.obterPoema(a);$('#criar-modal #editar-titulo-poema').val(b.titulo);const c=b.linhas.join('\n');$('#criar-modal #editar-conteudo-poema').val(c),this.atualizarTextField(),$('#criar-modal form').attr('action',`javascript:Pagina.interface.salvarPoema('${a}')`),$('#criar-modal').modal('open')},removerPoema(a){this.fecharModal('poema'),$('#deletar-modal #deletar').attr('onclick',`Pagina.interface.deletarPoema('${a}')`),$('#deletar-modal').modal('open')},async deletarPoema(a){await GerenciadorDePoemas.deletarPoema(a),this.atualizarLista('lista-de-poemas'),this.pesquisarPoema(),this.fecharModal('deletar')},fecharModal(a){$(`#${a}-modal`).modal('close')},async salvarPoema(a){const b=$('#criar-modal #editar-titulo-poema').val(),c=$('#criar-modal #editar-conteudo-poema').val().split('\n');if(a)var d=GerenciadorDePoemas.obterPoema(a).cor;else var d=null;await GerenciadorDePoemas.salvarPoema(a,b,c,d),this.atualizarLista('lista-de-poemas'),this.pesquisarPoema(),this.fecharModal('criar')},atualizarTextField(){M.updateTextFields()},mensagem(a){M.Toast.dismissAll(),M.toast({html:a,displayLength:1500})},pesquisarTextField(){$('#pesquisar').on('keyup',a=>{var b=a.which||a.keyCode;13==b&&this.pesquisarPoema()})},telaDeCarregamento(){const a=($(document).height()-$('.nav-wrapper').height()-$('.preloader-wrapper').height())/2;$('.preloader-wrapper').css('margin-top',a);const b=($('body').width()-$('.preloader-wrapper').width())/2;$('.preloader-wrapper').css('left',b),Pagina.window.onresize(this.telaDeCarregamento)},tema:{async iniciar(){await this.lerTema()},backgroundElements:['body','.sidenav','.sidenav .card','.sidenav .collapsible div','#criar-modal','#criar-modal .modal-footer','#deletar-modal','#deletar-modal .modal-footer','#cor-modal'],textElements:['#sem-poemas','#Tela_Busca #apresentacao','.input-field input','.sidenav','#criar-modal','#deletar-modal','textarea','#cor-modal'],async lerTema(){const a=await GerenciadorDePoemas.db.doc(`usuarios/${firebase.auth().currentUser.uid}`).get();a.exists?a.data().temaEscuro?this.aplicarModoEscuro():this.restaurar():firebase.firestore().doc(`usuarios/${firebase.auth().currentUser.uid}`).set({temaEscuro:this.temaEscuro})},alterarTema(){$('#tema').prop('checked')?this.aplicarModoEscuro():this.restaurar(),firebase.firestore().doc(`usuarios/${firebase.auth().currentUser.uid}`).set({temaEscuro:this.temaEscuro})},aplicarModoEscuro(){$('#tema').attr('checked',!0),this.temaEscuro=!0,this.textColor='white',$(this.backgroundElements.join(',')).addClass('grey darken-4'),$(this.textElements.join(',')).addClass('white-text')},temaEscuro:!1,restaurar(){$('#tema').attr('checked',!1),this.temaEscuro=!1,this.textColor='black',$(this.backgroundElements.join(',')).removeClass('grey darken-4'),$(this.textElements.join(',')).removeClass('white-text')}}},window:{onresize(a){window.addEventListener('resize',a,!1)}}},GerenciadorDePoemas={async iniciar(){await this.carregarFirestore(),await this.lerDadosDaDatabase(),Pagina.interface.atualizarLista('lista-de-poemas')},async carregarFirestore(){await firebase.firestore().enablePersistence(),this.db=firebase.firestore()},obterPoema(a){return this.poemas.find(b=>b.id==a)},async salvarPoema(a,b,c,d){a?(Pagina.interface.mensagem('Atualizando poema'),this.db.collection(`usuarios/${firebase.auth().currentUser.uid}/poemas`).doc(a).set({titulo:b,linhas:c,cor:d}).then(()=>{Pagina.interface.mensagem('Poema atualizado')}).catch(()=>{Pagina.interface.mensagem('Erro ao atualizar poema')})):(Pagina.interface.mensagem('Criando poema'),this.db.collection(`usuarios/${firebase.auth().currentUser.uid}/poemas`).add({titulo:b,linhas:c,cor:d}).then(()=>{Pagina.interface.mensagem('Poema criado')}).catch(()=>{Pagina.interface.mensagem('Erro ao criar poema')})),await this.lerDadosDaDatabase()},async deletarPoema(a){Pagina.interface.mensagem('Aguarde deletando poema'),this.db.doc(`usuarios/${firebase.auth().currentUser.uid}/poemas/${a}`).delete().then(()=>{Pagina.interface.mensagem('Poema deletado')}).catch(()=>{Pagina.interface.mensagem('Erro ao deletar poema')}),await this.lerDadosDaDatabase()},async lerDadosDaDatabase(){this.poemas=[];const a=(await this.db.collection(`usuarios/${firebase.auth().currentUser.uid}/poemas`).get()).docs;a.map(a=>{var b={titulo:a.data().titulo,linhas:a.data().linhas,cor:a.data().cor,id:a.id};this.poemas.push(b)})}},GerenteDeAutenticacao={iniciar(){this.autenticacao.iniciar()},autenticacao:{iniciar(){firebase.auth().onAuthStateChanged(async a=>{a&&(Pagina.interface.mensagem(`Seja Bem Vindo ${a.displayName}`),await GerenciadorDePoemas.iniciar(),await Pagina.interface.tema.iniciar()),Pagina.interface.login(a)})}},entrar(){var a=new firebase.auth.FacebookAuthProvider;firebase.auth().signInWithRedirect(a)},sair(){Pagina.interface.tema.restaurar(),firebase.auth().signOut()}};$(document).ready(()=>{Pagina.iniciar()});